---
title: "PM566 Final Project"
author: "Mengdi Chai"
date: '`r format(Sys.Date())`'
output: 
    html_document:
        theme: flatly
        highlight: tango
        toc: true
        toc_float: true
        css: style.css
---

```{r message=FALSE, echo=FALSE, warning=FALSE}
library(knitr)
# Initialize code chunk options
opts_chunk$set(
  warning = FALSE,
  message = FALSE,
  eval=TRUE,
  echo = TRUE,
  cache = FALSE,
  fig.width = 7, 
  fig.align = 'center',
  fig.asp = 0.618,
  out.width = "700px")
```

```{css, echo = FALSE}
.code-r { /* Code block */
  font-size: 15px;
}

.code-r-small { /* Code block */
  font-size: 10px;
}
```


<h2><strong> Introduction </strong> </h2> 

<p> Breast cancer becomes the second leading cause of cancer death in women, so it is necessary for us to analyze the data of breast cancer patients and to discover the pathway and mechanism of breast cancer-related genes due to the high prevalence and mortality rate. In this project, I want to examine how the age influences the female patients outcome when developing breast cancer by looking at several factors.  </p>


<h2><strong> Database </strong> </h2> 

<p> The Cancer Genome Atlas Program (TCGA) is a cancer genomics program that collects
 over 20,000 cancer tissue samples and matches them with normal samples spanning over 33
 cancer types (National Institute of Health). The data was sourced from TCGA with the TCGAbiolinks library using accession code “BRCA” </p>
 
```{r message=FALSE, echo=FALSE}
knitr::include_graphics("tcga.jpeg")
```


```{r load-data, message=FALSE, echo=FALSE, warning=FALSE, include=FALSE}
source("R_analysis.R")
```

<h2><strong> Distribution Analysis </strong> </h2> 

<p> The first factor I looked at is pathologic stage, and I examine the distribution of each pathologic stage in each different age category.The pathologic stage is very important since it helps us define the condition of cancer in patients' body </p>

<hr>

```{r plot_01, message=FALSE, echo=FALSE, warning=FALSE}
distribution_graph = ggplot(clinic_age_no_NAs, aes(age_category, after_stat(count))) + geom_bar(aes(fill =ajcc_pathologic_stage ), position = "dodge") + scale_fill_viridis_d() + labs(title="Distribution of pathologic stages in each age category", x = "age category", y= "count") + mynamestheme

ggplotly(distribution_graph)
```

<p> I find that in each category, most female patients are in stage IIA or stage IIB, whereas stage II and stage III have the least number of people. Stage 2 means the breast cancer is growing, but it is still contained in the breast or growth has only extended to the nearby lymph nodes. This stage is divided into groups: Stage 2A and Stage 2B. The difference is determined by the size of the tumor and whether the breast cancer has spread to the lymph nodes. Stage 3 means that the cancer has spread from the breast to lymph nodes close to the breast or to the skin of the breast or to the chest wall </p> 

<p> Then I want to examine the relationship between count of lymph node and age in female patients' vital status. Lymph node is another important markers to examine the breast cancer. If breast cancer spreads, it typically goes first to nearby lymph nodes under the arm. Therefore, we want to see how the count of lymph node affects female patients' vital status in different ages </p>  
<hr>

```{r plot_02, message=FALSE, echo=FALSE, warning=FALSE}
lymph_node_no_NAs %>% 
  plot_ly(x = ~age_at_initial_pathologic_diagnosis, y = ~lymph_node_examined_count, 
          type = 'scatter',
          mode = 'markers',
          color = ~vital_status,
          sizes = c(5, 70),
          marker = list(sizemode='diameter', opacity=0.5), hoverinfo = 'text',
          text = ~paste( 
                         paste("Age: ",age_at_initial_pathologic_diagnosis , sep="") ,
                         paste("Lymph Node Count: ", lymph_node_examined_count, sep=""),
                         paste("Vital Status: ", vital_status,sep=""),
                         sep = "<br>")) %>%
  layout(title = "Ages, Lymph Node Count for Female Breast Cancer Patients",
         xaxis = list(title = "age at diagnosis"), 
         yaxis = list(title = "lymph node count"),
         hovermode = "compare")
```
<p> Here we find that there is no significant relationship to see the correlation between age and the number of lymph node. In addition, it is hard to tell that with the increasing number of lymph node, how the vital status changes in female patients. There are still some limitations of this data analysis, including small sample size, sample bias, etc. </p>

<h2><strong> Survival Analysis </strong> </h2> 

<p> In many cancer studies, the main outcome under assessment is the time to an event of interest. If the event occurred in all individuals, many methods of analysis would be applicable. However, it is usual that at the end of follow-up some of the individuals have not had the event of interest, and thus their true time to event is unknown. Further, survival data are rarely Normally distributed, but are skewed and comprise typically of many early events and relatively few late ones. It is these features of the data that make the special methods called survival analysis necessary </p>

<p> Therefore, I did survival analysis in female patients and examined the survival difference between young and old patients on two conditions: with tumor and without tumor </p>

<hr>


### With Tumor

```{r plot_03, message=FALSE, echo=FALSE, warning=FALSE}
#the ggtheme and legend arguments are for formatting. 
# Feel free to play around with the margins and legend placement
survplot_with_tumor = ggsurvplot(age_fit_with_tumor, 
                                 legend = "right",
                                 legend.title = c("Age"),
                                 legend.labs = c("old (N=61)", "young (N=38)"),
                                 title="Kaplan-Meier Curve for Breast Cancer Survival with tumor (N=99)",
                                 ggtheme = theme_bw()) 

plotly::ggplotly(survplot_with_tumor[[1]])
```

### Without Tumor

```{r plot_04, message=FALSE, echo=FALSE, warning=FALSE}
survplot_tumor_free = ggsurvplot(age_fit_tumor_free, 
                                 legend = "right",
                                 legend.title = c("Age"),
                                 legend.labs = c("old (N=690)", "young (N=237)"),
                                 title="Kaplan-Meier Curve for Breast Cancer Survival without tumor (N=928)",
                                 ggtheme = theme_bw()) 

plotly::ggplotly(survplot_tumor_free[[1]])
```


<p> We can find that overall, female patients without tumor have higher survival probability than female patients with tumor. If we examine closer, we can see that there is no significant survival difference between young and old patients when they have tumor. However, in the tumor-free group, old patients experience much lower survival probability than young patients </p> 

